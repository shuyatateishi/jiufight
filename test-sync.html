<!DOCTYPE html>
<html lang="ja">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>ğŸ§ª ãƒªã‚¢ãƒ«ã‚¿ã‚¤ãƒ åŒæœŸãƒ†ã‚¹ãƒˆ - Jiufight | é–‹ç™ºè€…ç”¨ãƒ†ã‚¹ãƒˆç”»é¢</title>
    <meta name="description" content="Jiufightã®ãƒªã‚¢ãƒ«ã‚¿ã‚¤ãƒ åŒæœŸæ©Ÿèƒ½ã‚’ãƒ†ã‚¹ãƒˆã™ã‚‹ãŸã‚ã®é–‹ç™ºè€…ç”¨ç”»é¢">
    <meta name="robots" content="noindex, nofollow">
    
    <!-- Favicon -->
    <link rel="icon" type="image/svg+xml" href="data:image/svg+xml,<svg xmlns='http://www.w3.org/2000/svg' viewBox='0 0 100 100'><text y='.9em' font-size='90'>ğŸ§ª</text></svg>">
    <style>
        body {
            font-family: 'Inter', sans-serif;
            margin: 20px;
            background: #f5f5f5;
        }
        .test-container {
            max-width: 800px;
            margin: 0 auto;
            background: white;
            padding: 20px;
            border-radius: 10px;
            box-shadow: 0 2px 10px rgba(0,0,0,0.1);
        }
        .test-section {
            margin-bottom: 30px;
            padding: 15px;
            border: 1px solid #ddd;
            border-radius: 8px;
        }
        .test-result {
            padding: 10px;
            margin: 10px 0;
            border-radius: 5px;
        }
        .success { background: #d4edda; color: #155724; border: 1px solid #c3e6cb; }
        .error { background: #f8d7da; color: #721c24; border: 1px solid #f5c6cb; }
        .info { background: #d1ecf1; color: #0c5460; border: 1px solid #bee5eb; }
        button {
            background: #007bff;
            color: white;
            border: none;
            padding: 10px 20px;
            border-radius: 5px;
            cursor: pointer;
            margin: 5px;
        }
        button:hover { background: #0056b3; }
        .log {
            background: #f8f9fa;
            border: 1px solid #dee2e6;
            padding: 10px;
            height: 200px;
            overflow-y: auto;
            font-family: monospace;
            font-size: 12px;
            white-space: pre-wrap;
        }
    </style>
</head>
<body>
    <div class="test-container">
        <h1>ğŸ§ª Jiufight ãƒªã‚¢ãƒ«ã‚¿ã‚¤ãƒ åŒæœŸãƒ†ã‚¹ãƒˆ</h1>
        
        <div class="test-section">
            <h2>ğŸ“Š ç¾åœ¨ã®çŠ¶æ…‹</h2>
            <div id="current-status" class="test-result info">
                ã‚·ã‚¹ãƒ†ãƒ ã‚’èª­ã¿è¾¼ã¿ä¸­...
            </div>
        </div>
        
        <div class="test-section">
            <h2>ğŸ”„ é¸æ‰‹ãƒ‡ãƒ¼ã‚¿åŒæœŸãƒ†ã‚¹ãƒˆ</h2>
            <p>ã“ã®ãƒ†ã‚¹ãƒˆã§ã¯é¸æ‰‹ãƒ‡ãƒ¼ã‚¿ã®å¤‰æ›´ãŒæ­£ã—ãåŒæœŸã•ã‚Œã‚‹ã‹ã‚’ç¢ºèªã—ã¾ã™ã€‚</p>
            
            <button onclick="testFighterUpdate()">ãƒ†ã‚¹ãƒˆãƒ‡ãƒ¼ã‚¿ã§é¸æ‰‹æ›´æ–°</button>
            <button onclick="testCrossTabSync()">åˆ¥ã‚¿ãƒ–åŒæœŸãƒ†ã‚¹ãƒˆ</button>
            <button onclick="testPersistence()">æ°¸ç¶šåŒ–ãƒ†ã‚¹ãƒˆ</button>
            <button onclick="clearTestData()">ãƒ†ã‚¹ãƒˆãƒ‡ãƒ¼ã‚¿ã‚¯ãƒªã‚¢</button>
            
            <div id="fighter-test-results"></div>
        </div>
        
        <div class="test-section">
            <h2>ğŸ“ ãƒ­ã‚°</h2>
            <div id="test-log" class="log"></div>
        </div>
        
        <div class="test-section">
            <h2>ğŸ”— é–¢é€£ãƒšãƒ¼ã‚¸ãƒ†ã‚¹ãƒˆ</h2>
            <p>ã“ã‚Œã‚‰ã®ãƒªãƒ³ã‚¯ã‚’åˆ¥ã‚¿ãƒ–ã§é–‹ã„ã¦ã€åŒæœŸã‚’ãƒ†ã‚¹ãƒˆã—ã¦ãã ã•ã„ï¼š</p>
            <a href="fighters.html" target="_blank">é¸æ‰‹ä¸€è¦§ãƒšãƒ¼ã‚¸</a> | 
            <a href="rankings.html" target="_blank">ãƒ©ãƒ³ã‚­ãƒ³ã‚°ãƒšãƒ¼ã‚¸</a>
        </div>
    </div>

    <script src="realtime-sync.js"></script>
    <script>
        let testLog = [];
        
        function log(message, type = 'info') {
            const timestamp = new Date().toLocaleTimeString();
            const logEntry = `[${timestamp}] ${message}`;
            testLog.push(logEntry);
            
            const logElement = document.getElementById('test-log');
            logElement.textContent = testLog.join('\n');
            logElement.scrollTop = logElement.scrollHeight;
            
            console.log(logEntry);
        }
        
        function showResult(elementId, message, type) {
            const element = document.getElementById(elementId);
            element.className = `test-result ${type}`;
            element.textContent = message;
        }
        
        // åˆæœŸçŠ¶æ…‹ãƒã‚§ãƒƒã‚¯
        function checkInitialStatus() {
            log('ã‚·ã‚¹ãƒ†ãƒ åˆæœŸåŒ–ãƒã‚§ãƒƒã‚¯é–‹å§‹');
            
            // localStorageç¢ºèª
            const fightersData = localStorage.getItem('fightersData');
            const timestamp = localStorage.getItem('fightersData_timestamp');
            
            if (fightersData) {
                const data = JSON.parse(fightersData);
                log(`é¸æ‰‹ãƒ‡ãƒ¼ã‚¿ç™ºè¦‹: ${data.length}äººã®é¸æ‰‹`);
                showResult('current-status', `âœ… ${data.length}äººã®é¸æ‰‹ãƒ‡ãƒ¼ã‚¿ãŒä¿å­˜ã•ã‚Œã¦ã„ã¾ã™ (æœ€çµ‚æ›´æ–°: ${timestamp ? new Date(parseInt(timestamp)).toLocaleString() : 'ä¸æ˜'})`, 'success');
            } else {
                log('é¸æ‰‹ãƒ‡ãƒ¼ã‚¿ãŒè¦‹ã¤ã‹ã‚Šã¾ã›ã‚“');
                showResult('current-status', 'âš ï¸ é¸æ‰‹ãƒ‡ãƒ¼ã‚¿ãŒä¿å­˜ã•ã‚Œã¦ã„ã¾ã›ã‚“', 'error');
            }
            
            // ãƒªã‚¢ãƒ«ã‚¿ã‚¤ãƒ åŒæœŸã‚·ã‚¹ãƒ†ãƒ ç¢ºèª
            if (window.realtimeSync) {
                log('ãƒªã‚¢ãƒ«ã‚¿ã‚¤ãƒ åŒæœŸã‚·ã‚¹ãƒ†ãƒ : åˆ©ç”¨å¯èƒ½');
                
                // ã‚³ãƒ¼ãƒ«ãƒãƒƒã‚¯ç™»éŒ²
                window.realtimeSync.onFighterUpdate((updatedData) => {
                    log(`ğŸ”„ ãƒªã‚¢ãƒ«ã‚¿ã‚¤ãƒ æ›´æ–°æ¤œå‡º: ${updatedData.length}äººã®é¸æ‰‹ãƒ‡ãƒ¼ã‚¿`);
                    showResult('fighter-test-results', `ğŸ”„ ãƒªã‚¢ãƒ«ã‚¿ã‚¤ãƒ æ›´æ–°ã‚’å—ä¿¡ã—ã¾ã—ãŸ (${updatedData.length}äºº)`, 'success');
                });
            } else {
                log('âŒ ãƒªã‚¢ãƒ«ã‚¿ã‚¤ãƒ åŒæœŸã‚·ã‚¹ãƒ†ãƒ ãŒåˆ©ç”¨ã§ãã¾ã›ã‚“');
                showResult('current-status', 'âŒ ãƒªã‚¢ãƒ«ã‚¿ã‚¤ãƒ åŒæœŸã‚·ã‚¹ãƒ†ãƒ ã‚¨ãƒ©ãƒ¼', 'error');
            }
        }
        
        // é¸æ‰‹ãƒ‡ãƒ¼ã‚¿æ›´æ–°ãƒ†ã‚¹ãƒˆ
        function testFighterUpdate() {
            log('é¸æ‰‹ãƒ‡ãƒ¼ã‚¿æ›´æ–°ãƒ†ã‚¹ãƒˆé–‹å§‹');
            
            const testFighter = {
                id: 9999,
                name: 'ãƒ†ã‚¹ãƒˆé¸æ‰‹',
                nickname: 'ãƒ†ã‚¹ãƒˆãƒ•ã‚¡ã‚¤ã‚¿ãƒ¼',
                belt: 'black',
                weight: 'test',
                dojo: 'ãƒ†ã‚¹ãƒˆé“å ´',
                wins: 999,
                losses: 0,
                bio: 'ãƒªã‚¢ãƒ«ã‚¿ã‚¤ãƒ åŒæœŸãƒ†ã‚¹ãƒˆç”¨ã®é¸æ‰‹ãƒ‡ãƒ¼ã‚¿ã§ã™',
                fullName: 'ãƒ†ã‚¹ãƒˆå¤ªéƒ',
                age: '25',
                occupation: 'ãƒ†ã‚¹ã‚¿ãƒ¼',
                location: 'ãƒ†ã‚¹ãƒˆçœŒ',
                experience: 'ãƒ†ã‚¹ãƒˆæ­´10å¹´',
                specialty: 'ãƒ†ã‚¹ãƒˆæŠ€',
                characteristic: 'ã„ã¤ã‚‚ãƒ†ã‚¹ãƒˆã—ã¦ã‚‹',
                motivation: 'ãƒ†ã‚¹ãƒˆã«å‹ã¡ãŸã„ï¼',
                lastUpdated: new Date().toISOString()
            };
            
            // æ—¢å­˜ãƒ‡ãƒ¼ã‚¿å–å¾—
            let fightersData = [];
            const existingData = localStorage.getItem('fightersData');
            if (existingData) {
                fightersData = JSON.parse(existingData);
            }
            
            // ãƒ†ã‚¹ãƒˆé¸æ‰‹ã‚’è¿½åŠ /æ›´æ–°
            const existingIndex = fightersData.findIndex(f => f.id === 9999);
            if (existingIndex >= 0) {
                fightersData[existingIndex] = testFighter;
                log('ãƒ†ã‚¹ãƒˆé¸æ‰‹ãƒ‡ãƒ¼ã‚¿ã‚’æ›´æ–°');
            } else {
                fightersData.push(testFighter);
                log('ãƒ†ã‚¹ãƒˆé¸æ‰‹ãƒ‡ãƒ¼ã‚¿ã‚’è¿½åŠ ');
            }
            
            // ãƒªã‚¢ãƒ«ã‚¿ã‚¤ãƒ åŒæœŸã§ä¿å­˜
            if (window.realtimeSync) {
                window.realtimeSync.updateFighters(fightersData);
                log('âœ… ãƒªã‚¢ãƒ«ã‚¿ã‚¤ãƒ åŒæœŸã‚·ã‚¹ãƒ†ãƒ ã§æ›´æ–°å®Œäº†');
                showResult('fighter-test-results', 'âœ… ãƒ†ã‚¹ãƒˆé¸æ‰‹ãƒ‡ãƒ¼ã‚¿ã‚’æ›´æ–°ã—ã¾ã—ãŸ', 'success');
            } else {
                localStorage.setItem('fightersData', JSON.stringify(fightersData));
                log('âš ï¸ ãƒ•ã‚©ãƒ¼ãƒ«ãƒãƒƒã‚¯: localStorageç›´æ¥ä¿å­˜');
                showResult('fighter-test-results', 'âš ï¸ ãƒ•ã‚©ãƒ¼ãƒ«ãƒãƒƒã‚¯ä¿å­˜ã—ã¾ã—ãŸ', 'info');
            }
        }
        
        // åˆ¥ã‚¿ãƒ–åŒæœŸãƒ†ã‚¹ãƒˆ
        function testCrossTabSync() {
            log('åˆ¥ã‚¿ãƒ–åŒæœŸãƒ†ã‚¹ãƒˆé–‹å§‹');
            showResult('fighter-test-results', 'ğŸ”„ åˆ¥ã‚¿ãƒ–ã‚’é–‹ã„ã¦åŒæœŸã‚’ãƒ†ã‚¹ãƒˆã—ã¦ãã ã•ã„...', 'info');
            
            // é¸æ‰‹ä¸€è¦§ã¨ãƒ©ãƒ³ã‚­ãƒ³ã‚°ãƒšãƒ¼ã‚¸ã‚’é–‹ã
            window.open('fighters.html', '_blank');
            window.open('rankings.html', '_blank');
            
            log('é¸æ‰‹ä¸€è¦§ãƒšãƒ¼ã‚¸ã¨ãƒ©ãƒ³ã‚­ãƒ³ã‚°ãƒšãƒ¼ã‚¸ã‚’æ–°ã—ã„ã‚¿ãƒ–ã§é–‹ãã¾ã—ãŸ');
            log('å„ãƒšãƒ¼ã‚¸ã§ãƒ†ã‚¹ãƒˆé¸æ‰‹ï¼ˆID: 9999ï¼‰ã®ãƒ—ãƒ­ãƒ•ã‚£ãƒ¼ãƒ«ã‚’ç·¨é›†ã—ã¦ã¿ã¦ãã ã•ã„');
        }
        
        // æ°¸ç¶šåŒ–ãƒ†ã‚¹ãƒˆ
        function testPersistence() {
            log('æ°¸ç¶šåŒ–ãƒ†ã‚¹ãƒˆé–‹å§‹');
            
            const timestamp = localStorage.getItem('fightersData_timestamp');
            if (timestamp) {
                const lastUpdate = new Date(parseInt(timestamp));
                const now = new Date();
                const timeDiff = now - lastUpdate;
                
                log(`æœ€çµ‚æ›´æ–°: ${lastUpdate.toLocaleString()}`);
                log(`çµŒéæ™‚é–“: ${Math.round(timeDiff / 1000)}ç§’`);
                
                if (timeDiff > 30000) { // 30ç§’ä»¥ä¸Šå‰
                    showResult('fighter-test-results', `âœ… ãƒ‡ãƒ¼ã‚¿ãŒ${Math.round(timeDiff / 1000)}ç§’é–“æ°¸ç¶šåŒ–ã•ã‚Œã¦ã„ã¾ã™`, 'success');
                } else {
                    showResult('fighter-test-results', `ğŸ“Š ãƒ‡ãƒ¼ã‚¿ä¿å­˜ã‹ã‚‰${Math.round(timeDiff / 1000)}ç§’çµŒé`, 'info');
                }
            } else {
                showResult('fighter-test-results', 'âŒ æ°¸ç¶šåŒ–ãƒ‡ãƒ¼ã‚¿ãŒè¦‹ã¤ã‹ã‚Šã¾ã›ã‚“', 'error');
                log('æ°¸ç¶šåŒ–ãƒ‡ãƒ¼ã‚¿ã®ã‚¿ã‚¤ãƒ ã‚¹ã‚¿ãƒ³ãƒ—ãŒè¦‹ã¤ã‹ã‚Šã¾ã›ã‚“');
            }
            
            // ãƒšãƒ¼ã‚¸ãƒªãƒ­ãƒ¼ãƒ‰ãƒ†ã‚¹ãƒˆææ¡ˆ
            setTimeout(() => {
                if (confirm('ãƒšãƒ¼ã‚¸ã‚’ãƒªãƒ­ãƒ¼ãƒ‰ã—ã¦æ°¸ç¶šåŒ–ã‚’ãƒ†ã‚¹ãƒˆã—ã¾ã™ã‹ï¼Ÿ')) {
                    location.reload();
                }
            }, 1000);
        }
        
        // ãƒ†ã‚¹ãƒˆãƒ‡ãƒ¼ã‚¿ã‚¯ãƒªã‚¢
        function clearTestData() {
            log('ãƒ†ã‚¹ãƒˆãƒ‡ãƒ¼ã‚¿ã‚¯ãƒªã‚¢é–‹å§‹');
            
            let fightersData = [];
            const existingData = localStorage.getItem('fightersData');
            if (existingData) {
                fightersData = JSON.parse(existingData);
                
                // ãƒ†ã‚¹ãƒˆé¸æ‰‹å‰Šé™¤
                fightersData = fightersData.filter(f => f.id !== 9999);
                
                if (window.realtimeSync) {
                    window.realtimeSync.updateFighters(fightersData);
                    log('âœ… ãƒ†ã‚¹ãƒˆé¸æ‰‹ãƒ‡ãƒ¼ã‚¿ã‚’å‰Šé™¤ï¼ˆãƒªã‚¢ãƒ«ã‚¿ã‚¤ãƒ åŒæœŸï¼‰');
                } else {
                    localStorage.setItem('fightersData', JSON.stringify(fightersData));
                    log('âœ… ãƒ†ã‚¹ãƒˆé¸æ‰‹ãƒ‡ãƒ¼ã‚¿ã‚’å‰Šé™¤ï¼ˆlocalStorageï¼‰');
                }
                
                showResult('fighter-test-results', 'âœ… ãƒ†ã‚¹ãƒˆãƒ‡ãƒ¼ã‚¿ã‚’ã‚¯ãƒªã‚¢ã—ã¾ã—ãŸ', 'success');
            } else {
                log('ã‚¯ãƒªã‚¢ã™ã‚‹ãƒ‡ãƒ¼ã‚¿ãŒè¦‹ã¤ã‹ã‚Šã¾ã›ã‚“');
                showResult('fighter-test-results', 'â„¹ï¸ ã‚¯ãƒªã‚¢ã™ã‚‹ãƒ‡ãƒ¼ã‚¿ãŒã‚ã‚Šã¾ã›ã‚“', 'info');
            }
        }
        
        // åˆæœŸåŒ–
        document.addEventListener('DOMContentLoaded', () => {
            log('ãƒ†ã‚¹ãƒˆãƒšãƒ¼ã‚¸ã‚’åˆæœŸåŒ–ã—ã¦ã„ã¾ã™...');
            setTimeout(checkInitialStatus, 500);
        });
        
        // å®šæœŸçš„ãªçŠ¶æ…‹ç›£è¦–
        setInterval(() => {
            const timestamp = localStorage.getItem('fightersData_timestamp');
            if (timestamp) {
                const lastUpdate = new Date(parseInt(timestamp));
                const status = document.getElementById('current-status');
                if (status && status.textContent.includes('é¸æ‰‹ãƒ‡ãƒ¼ã‚¿ãŒä¿å­˜ã•ã‚Œã¦ã„ã¾ã™')) {
                    const data = JSON.parse(localStorage.getItem('fightersData') || '[]');
                    status.textContent = `âœ… ${data.length}äººã®é¸æ‰‹ãƒ‡ãƒ¼ã‚¿ãŒä¿å­˜ã•ã‚Œã¦ã„ã¾ã™ (æœ€çµ‚æ›´æ–°: ${lastUpdate.toLocaleString()})`;
                }
            }
        }, 5000);
    </script>
</body>
</html>